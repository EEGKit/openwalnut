## This file is somehow copy and pasted as well as edited from the original file from niftilib src-package
#PROJECT(NIFTILIB)

MESSAGE( STATUS "Inlcuded NIfTI lib building information." )

OPTION ( BUILD_SHARED_LIBS "Toggle building shared libraries" ON)

# Zlib support currently only on Linux 
IF( CMAKE_HOST_SYSTEM MATCHES Linux )
	ADD_DEFINITIONS(-DHAVE_ZLIB)
ENDIF()

SET(ZNZLIB_SRC znzlib.c)
SET(NIFTI_ZNZLIB_NAME ${PACKAGE_PREFIX}znz)
ADD_LIBRARY(${NIFTI_ZNZLIB_NAME} ${ZNZLIB_SRC} )
TARGET_LINK_LIBRARIES( ${NIFTI_ZNZLIB_NAME} ${NIFTI_ZLIB_LIBRARIES} )

# Zlib support currently only on Linux 
IF( CMAKE_HOST_SYSTEM MATCHES Linux )
	TARGET_LINK_LIBRARIES( ${NIFTI_ZNZLIB_NAME} z) 
ENDIF()

# Set library version when building shared libs.
IF (BUILD_SHARED_LIBS)
  SET(CPACK_PACKAGE_VERSION_MAJOR "1")
  SET(CPACK_PACKAGE_VERSION_MINOR "1")
  SET(CPACK_PACKAGE_VERSION_PATCH "0")
  SET(NIFTI_SHAREDLIB_VERSION ${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.${CPACK_PACKAGE_VERSION_PATCH} )
  STRING( REGEX MATCH "^[0-9]+" NIFTI_SHAREDLIB_SOVERSION ${NIFTI_SHAREDLIB_VERSION})
  SET(NIFTI_LIBRARY_PROPERTIES VERSION ${NIFTI_SHAREDLIB_VERSION} SOVERSION ${NIFTI_SHAREDLIB_SOVERSION})
  SET_TARGET_PROPERTIES(${NIFTI_NIFTILIB_NAME} PROPERTIES ${NIFTI_LIBRARY_PROPERTIES})
  SET_TARGET_PROPERTIES(${NIFTI_ZNZLIB_NAME} PROPERTIES ${NIFTI_LIBRARY_PROPERTIES})
ENDIF (BUILD_SHARED_LIBS)


SET(NIFTILIB_SRC nifti1_io.c)
SET(NIFTI_NIFTILIB_NAME ${PACKAGE_PREFIX}niftiio)
ADD_LIBRARY(${NIFTI_NIFTILIB_NAME} ${NIFTILIB_SRC} )
TARGET_LINK_LIBRARIES( ${NIFTI_NIFTILIB_NAME} ${PACKAGE_PREFIX}znz)


IF(UNIX)
  TARGET_LINK_LIBRARIES(${NIFTI_NIFTILIB_NAME} -lm)
ENDIF(UNIX)
